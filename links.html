<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Box</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0b0f;
            --bg-secondary: #16171d;
            --bg-card: #1a1c25;
            --bg-card-hover: #21242e;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-tertiary: #06b6d4;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border-color: #334155;
            --focus-ring: #6366f1;
            --overlay: rgba(0, 0, 0, 0.8);
            --gradient-primary: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            --gradient-card: linear-gradient(145deg, #1a1c25 0%, #1e212a 100%);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            --shadow-glow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(6, 182, 212, 0.05) 0%, transparent 50%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 3rem;
            background: var(--gradient-primary);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(99, 102, 241, 0.3);
        }

        .add-button-container {
            display: flex;
            justify-content: center;
            margin-bottom: 3rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            color: white;
            padding: 0.875rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .btn-danger {
            background: var(--accent-danger);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            flex-grow: 1;
            align-content: start;
        }

        .link-card-container {
            position: relative;
        }

        .link-card {
            background: var(--gradient-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem 1rem;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            text-decoration: none;
            color: inherit;
            display: block;
            height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .link-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .link-card:hover::before {
            opacity: 1;
        }

        .link-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
        }

        .link-card:focus {
            outline: 2px solid var(--focus-ring);
            outline-offset: 2px;
        }

        .link-icon {
            width: 64px;
            height: 64px;
            border-radius: 12px;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        .link-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }

        .link-icon i {
            font-size: 2rem;
            color: var(--accent-primary);
        }

        .link-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            position: relative;
            z-index: 1;
        }

        .edit-button {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-secondary);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            opacity: 0;
            transform: scale(0.9);
        }

        .link-card-container:hover .edit-button {
            opacity: 1;
            transform: scale(1);
        }

        .edit-button:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .modal-overlay.show .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem 1.5rem;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.875rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--focus-ring);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-control::placeholder {
            color: var(--text-muted);
        }

        .input-group {
            display: flex;
            gap: 0;
        }

        .input-group .form-control {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: none;
        }

        .input-group .btn-secondary {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            white-space: nowrap;
        }

        .icon {
            width: 1rem;
            height: 1rem;
            fill: currentColor;
        }

        .icon-selector {
            margin-top: 0.5rem;
        }

        .icon-selector-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
        }

        .icon-preview {
            width: 48px;
            height: 48px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .icon-preview:hover {
            border-color: var(--accent-primary);
        }

        .icon-preview i {
            font-size: 1.5rem;
            color: var(--accent-primary);
        }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            padding: 0.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .icon-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .icon-option:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .icon-option.selected {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .icon-option i {
            font-size: 1.25rem;
        }

        .custom-icon-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 1px;
            left: 1px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(20px);
        }

        .icon-selector-container {
            display: none;
        }

        .icon-selector-container.show {
            display: block;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
                margin-bottom: 2rem;
            }

            .container {
                padding: 1rem;
            }

            .links-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 1rem;
            }

            .link-card {
                padding: 1.5rem 1rem;
                height: 160px;
            }

            .link-icon {
                width: 48px;
                height: 48px;
                margin-bottom: 0.75rem;
            }

            .link-title {
                font-size: 1rem;
            }

            .modal {
                margin: 1rem;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .link-card-container {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TV Box</h1>
        
        <!-- Add Link Button -->
        <div class="add-button-container">
            <button class="btn-primary" onclick="openAddModal()">
                <svg class="icon" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                </svg>
                Add New Link
            </button>
        </div>

        <!-- Links Grid -->
        <div class="links-grid" id="linksGrid">
            <div class="link-card-container">
                <a href="https://www.youtube.com" target="_blank" class="link-card">
                    <div class="link-icon">
                        <img src="https://logo.clearbit.com/youtube.com" alt="YouTube" onerror="handleIconError(this, 'youtube.com', 'YouTube', 1)">
                    </div>
                    <h5 class="link-title">YouTube</h5>
                </a>
                <button class="edit-button" onclick="editLink(this)" title="Edit">
                    <svg class="icon" viewBox="0 0 20 20">
                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                    </svg>
                </button>
            </div>
            <div class="link-card-container">
                <a href="https://www.netflix.com" target="_blank" class="link-card">
                    <div class="link-icon">
                        <img src="https://logo.clearbit.com/netflix.com" alt="Netflix" onerror="handleIconError(this, 'netflix.com', 'Netflix', 1)">
                    </div>
                    <h5 class="link-title">Netflix</h5>
                </a>
                <button class="edit-button" onclick="editLink(this)" title="Edit">
                    <svg class="icon" viewBox="0 0 20 20">
                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Add Link Modal -->
    <div class="modal-overlay" id="addLinkModal">
        <div class="modal">
            <div class="modal-header">
                <h5 class="modal-title">Add New Link</h5>
                <button type="button" class="modal-close" onclick="closeAddModal()">×</button>
            </div>
            <div class="modal-body">
                <form id="addLinkForm">
                    <div class="form-group">
                        <label for="linkName" class="form-label">Name</label>
                        <input type="text" class="form-control" id="linkName" required>
                    </div>
                    <div class="form-group">
                        <label for="linkUrl" class="form-label">URL</label>
                        <div class="input-group">
                            <input type="url" class="form-control" id="linkUrl" required>
                            <a href="https://www.google.com" target="_blank" class="btn-secondary">
                                <svg class="icon" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                </svg>
                                Search
                            </a>
                        </div>
                    </div>
                    <div class="icon-selector">
                        <div class="custom-icon-toggle">
                            <span class="form-label">Use custom icon</span>
                            <div class="toggle-switch" id="addCustomIconToggle" onclick="toggleCustomIcon('add')"></div>
                        </div>
                        <div class="icon-selector-container" id="addIconSelector">
                            <label class="icon-selector-label">Choose an icon:</label>
                            <div class="icon-preview" id="addIconPreview">
                                <i class="bi bi-link-45deg"></i>
                            </div>
                            <div class="icon-grid" id="addIconGrid"></div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeAddModal()">Cancel</button>
                <button type="button" class="btn-primary" onclick="addNewLink()">Add Link</button>
            </div>
        </div>
    </div>

    <!-- Edit Link Modal -->
    <div class="modal-overlay" id="editLinkModal">
        <div class="modal">
            <div class="modal-header">
                <h5 class="modal-title">Edit Link</h5>
                <button type="button" class="modal-close" onclick="closeEditModal()">×</button>
            </div>
            <div class="modal-body">
                <form id="editLinkForm">
                    <div class="form-group">
                        <label for="editLinkName" class="form-label">Name</label>
                        <input type="text" class="form-control" id="editLinkName" required>
                    </div>
                    <div class="form-group">
                        <label for="editLinkUrl" class="form-label">URL</label>
                        <div class="input-group">
                            <input type="url" class="form-control" id="editLinkUrl" required>
                            <a href="https://www.google.com" target="_blank" class="btn-secondary">
                                <svg class="icon" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                </svg>
                                Search
                            </a>
                        </div>
                    </div>
                    <div class="icon-selector">
                        <div class="custom-icon-toggle">
                            <span class="form-label">Use custom icon</span>
                            <div class="toggle-switch" id="editCustomIconToggle" onclick="toggleCustomIcon('edit')"></div>
                        </div>
                        <div class="icon-selector-container" id="editIconSelector">
                            <label class="icon-selector-label">Choose an icon:</label>
                            <div class="icon-preview" id="editIconPreview">
                                <i class="bi bi-link-45deg"></i>
                            </div>
                            <div class="icon-grid" id="editIconGrid"></div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeEditModal()">Cancel</button>
                <button type="button" class="btn-danger" onclick="deleteLink()">Delete</button>
                <button type="button" class="btn-primary" onclick="saveEditedLink()">Save Changes</button>
            </div>
        </div>
    </div>
    <script>
        // Popular Bootstrap icons for streaming/media services
        const popularIcons = [
            'bi-play-circle', 'bi-film', 'bi-tv', 'bi-music-note-beamed', 'bi-headphones',
            'bi-camera-video', 'bi-broadcast', 'bi-disc', 'bi-vinyl', 'bi-cassette',
            'bi-speaker', 'bi-boombox', 'bi-mic', 'bi-radio', 'bi-youtube',
            'bi-facebook', 'bi-twitter', 'bi-instagram', 'bi-linkedin', 'bi-github',
            'bi-google', 'bi-microsoft', 'bi-apple', 'bi-amazon', 'bi-netflix',
            'bi-spotify', 'bi-twitch', 'bi-discord', 'bi-reddit', 'bi-pinterest',
            'bi-whatsapp', 'bi-telegram', 'bi-slack', 'bi-zoom', 'bi-skype',
            'bi-gamepad2', 'bi-controller', 'bi-joystick', 'bi-puzzle', 'bi-dice-1',
            'bi-heart', 'bi-star', 'bi-bookmark', 'bi-flag', 'bi-trophy',
            'bi-gift', 'bi-camera', 'bi-images', 'bi-palette', 'bi-brush',
            'bi-scissors', 'bi-hammer', 'bi-wrench', 'bi-gear', 'bi-tools',
            'bi-house', 'bi-building', 'bi-shop', 'bi-cart', 'bi-bag',
            'bi-wallet', 'bi-credit-card', 'bi-piggy-bank', 'bi-currency-dollar', 'bi-graph-up',
            'bi-newspaper', 'bi-book', 'bi-journal', 'bi-pencil', 'bi-pen',
            'bi-calendar', 'bi-clock', 'bi-alarm', 'bi-stopwatch', 'bi-hourglass',
            'bi-globe', 'bi-compass', 'bi-map', 'bi-geo-alt', 'bi-airplane',
            'bi-train', 'bi-car-front', 'bi-bicycle', 'bi-scooter', 'bi-truck',
            'bi-cloud', 'bi-sun', 'bi-moon', 'bi-snow', 'bi-thermometer',
            'bi-lightbulb', 'bi-fire', 'bi-droplet', 'bi-tree', 'bi-flower1'
        ];

        let selectedCustomIcon = {
            add: null,
            edit: null
        };

        // Modal functionality
        function openAddModal() {
            document.getElementById('addLinkModal').classList.add('show');
            initializeIconGrid('add');
        }

        function closeAddModal() {
            document.getElementById('addLinkModal').classList.remove('show');
        }

        function openEditModal() {
            document.getElementById('editLinkModal').classList.add('show');
            initializeIconGrid('edit');
        }

        function closeEditModal() {
            document.getElementById('editLinkModal').classList.remove('show');
        }

        // Icon selector functionality
        function toggleCustomIcon(modalType) {
            const toggle = document.getElementById(`${modalType}CustomIconToggle`);
            const selector = document.getElementById(`${modalType}IconSelector`);
            
            toggle.classList.toggle('active');
            selector.classList.toggle('show');
            
            if (!toggle.classList.contains('active')) {
                selectedCustomIcon[modalType] = null;
            }
        }

        function initializeIconGrid(modalType) {
            const grid = document.getElementById(`${modalType}IconGrid`);
            grid.innerHTML = '';
            
            popularIcons.forEach(iconClass => {
                const iconOption = document.createElement('div');
                iconOption.className = 'icon-option';
                iconOption.innerHTML = `<i class="bi ${iconClass}"></i>`;
                iconOption.onclick = () => selectIcon(modalType, iconClass, iconOption);
                grid.appendChild(iconOption);
            });
        }

        function selectIcon(modalType, iconClass, element) {
            // Remove previous selection
            const grid = document.getElementById(`${modalType}IconGrid`);
            grid.querySelectorAll('.icon-option').forEach(opt => opt.classList.remove('selected'));
            
            // Add selection to clicked element
            element.classList.add('selected');
            
            // Update preview
            const preview = document.getElementById(`${modalType}IconPreview`);
            preview.innerHTML = `<i class="bi ${iconClass}"></i>`;
            
            // Store selection
            selectedCustomIcon[modalType] = iconClass;
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('show');
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelector('.modal-overlay.show')?.classList.remove('show');
            }
        });

        function handleIconError(img, domain, name, step = 1) {
            const baseStyle = "width: 100%; height: 100%; object-fit: contain; border-radius: 12px;";
            
            if (step === 1) {
                // Try high-res Apple touch icon first
                img.src = `https://${domain}/apple-touch-icon.png`;
                img.style.cssText = baseStyle;
                img.onerror = () => handleIconError(img, domain, name, 2);
            } else if (step === 2) {
                // Try Clearbit logo API (high quality)
                img.src = `https://logo.clearbit.com/${domain}`;
                img.style.cssText = baseStyle;
                img.onerror = () => handleIconError(img, domain, name, 3);
            } else if (step === 3) {
                // Try Google high-res favicon
                img.src = `https://www.google.com/s2/favicons?domain=${domain}&sz=128`;
                img.style.cssText = baseStyle;
                img.onerror = () => handleIconError(img, domain, name, 4);
            } else {
                // Final fallback to link SVG icon
                img.outerHTML = `<svg viewBox="0 0 20 20" style="width: 100%; height: 100%; color: var(--accent-primary);">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"/>
                </svg>`;
            }
        }

        function createIconImg(url, name, customIcon = null) {
            // If custom icon is specified, use Bootstrap icon
            if (customIcon) {
                return `<i class="bi ${customIcon}" style="font-size: 4rem; color: var(--accent-primary);"></i>`;
            }
            
            try {
                const urlObj = new URL(url);
                const domain = urlObj.hostname;
                
                // Start with Clearbit's logo API - provides high-quality SVG/PNG logos
                return `<img src="https://logo.clearbit.com/${domain}" alt="${name}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 12px;" onerror="handleIconError(this, '${domain}', '${name}', 1)">`;
            } catch (e) {
                return `<svg viewBox="0 0 20 20" style="width: 100%; height: 100%; color: var(--accent-primary);">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"/>
                </svg>`;
            }
        }

        function addNewLink() {
            const name = document.getElementById('linkName').value.trim();
            const url = document.getElementById('linkUrl').value.trim();

            if (!name || !url) {
                alert('Please fill in all required fields.');
                return;
            }

            const customIcon = selectedCustomIcon.add;
            const linksGrid = document.getElementById('linksGrid');
            const faviconHtml = createIconImg(url, name, customIcon);
            
            const newLinkHTML = `
                <div class="link-card-container">
                    <a href="${url}" target="_blank" class="link-card">
                        <div class="link-icon">
                            ${faviconHtml}
                        </div>
                        <h5 class="link-title">${name}</h5>
                    </a>
                    <button class="edit-button" onclick="editLink(this)" title="Edit">
                        <svg class="icon" viewBox="0 0 20 20">
                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                        </svg>
                    </button>
                </div>
            `;

            linksGrid.insertAdjacentHTML('beforeend', newLinkHTML);

            // Clear form and close modal
            document.getElementById('addLinkForm').reset();
            document.getElementById('addCustomIconToggle').classList.remove('active');
            document.getElementById('addIconSelector').classList.remove('show');
            selectedCustomIcon.add = null;
            closeAddModal();

            // Save to localStorage
            saveLinksToStorage();
        }

        function saveLinksToStorage() {
            const links = [];
            const linkCards = document.querySelectorAll('#linksGrid .link-card-container');
            
            linkCards.forEach(card => {
                const link = card.querySelector('a');
                const title = card.querySelector('.link-title');
                const icon = card.querySelector('.link-icon i');
                
                if (link && title) {
                    const linkData = {
                        name: title.textContent,
                        url: link.href
                    };
                    
                    // Check if it's using a custom Bootstrap icon
                    if (icon && icon.className.includes('bi-')) {
                        const iconClasses = icon.className.split(' ');
                        const bootstrapIcon = iconClasses.find(cls => cls.startsWith('bi-'));
                        linkData.customIcon = bootstrapIcon;
                    }
                    
                    links.push(linkData);
                }
            });
            
            localStorage.setItem('tvBoxLinks', JSON.stringify(links));
        }

        function loadLinksFromStorage() {
            const savedLinks = localStorage.getItem('tvBoxLinks');
            if (savedLinks) {
                const links = JSON.parse(savedLinks);
                const linksGrid = document.getElementById('linksGrid');
                
                // Clear existing links except the first two (YouTube and Netflix)
                const existingLinks = linksGrid.querySelectorAll('.link-card-container');
                for (let i = 2; i < existingLinks.length; i++) {
                    existingLinks[i].remove();
                }
                
                // Add saved links (skip first two which are defaults)
                for (let i = 2; i < links.length; i++) {
                    const link = links[i];
                    let faviconHtml;
                    
                    // Check if it has a custom icon
                    if (link.customIcon) {
                        faviconHtml = createIconImg(link.url, link.name, link.customIcon);
                    } else {
                        // Always use createIconImg for consistent styling and fallback behavior
                        faviconHtml = createIconImg(link.url, link.name);
                    }
                    
                    const newLinkHTML = `
                        <div class="link-card-container">
                            <a href="${link.url}" target="_blank" class="link-card">
                                <div class="link-icon">
                                    ${faviconHtml}
                                </div>
                                <h5 class="link-title">${link.name}</h5>
                            </a>
                            <button class="edit-button" onclick="editLink(this)" title="Edit">
                                <svg class="icon" viewBox="0 0 20 20">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                                </svg>
                            </button>
                        </div>
                    `;
                    linksGrid.insertAdjacentHTML('beforeend', newLinkHTML);
                }
            }
        }

        let currentEditingCard = null;

        function editLink(button) {
            currentEditingCard = button.closest('.link-card-container');
            const link = currentEditingCard.querySelector('a');
            const title = currentEditingCard.querySelector('.link-title');
            const icon = currentEditingCard.querySelector('.link-icon i');
            
            // Populate edit form with current values
            document.getElementById('editLinkName').value = title.textContent;
            document.getElementById('editLinkUrl').value = link.href;
            
            // Reset custom icon state
            document.getElementById('editCustomIconToggle').classList.remove('active');
            document.getElementById('editIconSelector').classList.remove('show');
            selectedCustomIcon.edit = null;
            
            // Check if it has a custom Bootstrap icon
            if (icon && icon.className.includes('bi-')) {
                const iconClasses = icon.className.split(' ');
                const bootstrapIcon = iconClasses.find(cls => cls.startsWith('bi-'));
                
                if (bootstrapIcon) {
                    // Enable custom icon mode
                    document.getElementById('editCustomIconToggle').classList.add('active');
                    document.getElementById('editIconSelector').classList.add('show');
                    selectedCustomIcon.edit = bootstrapIcon;
                    
                    // Update preview
                    document.getElementById('editIconPreview').innerHTML = `<i class="bi ${bootstrapIcon}"></i>`;
                }
            }
            
            // Show edit modal
            openEditModal();
        }

        function saveEditedLink() {
            const name = document.getElementById('editLinkName').value.trim();
            const url = document.getElementById('editLinkUrl').value.trim();

            if (!name || !url) {
                alert('Please fill in all required fields.');
                return;
            }

            if (currentEditingCard) {
                // Update the link
                const link = currentEditingCard.querySelector('a');
                const title = currentEditingCard.querySelector('.link-title');
                const iconContainer = currentEditingCard.querySelector('.link-icon');
                
                link.href = url;
                title.textContent = name;
                
                // Update favicon with custom icon if selected
                const customIcon = selectedCustomIcon.edit;
                const faviconHtml = createIconImg(url, name, customIcon);
                iconContainer.innerHTML = faviconHtml;
                
                // Save to localStorage
                saveLinksToStorage();
                
                // Close modal and reset state
                document.getElementById('editCustomIconToggle').classList.remove('active');
                document.getElementById('editIconSelector').classList.remove('show');
                selectedCustomIcon.edit = null;
                closeEditModal();
                
                currentEditingCard = null;
            }
        }

        function deleteLink() {
            if (currentEditingCard && confirm('Are you sure you want to delete this link?')) {
                currentEditingCard.remove();
                saveLinksToStorage();
                
                // Close modal
                closeEditModal();
                
                currentEditingCard = null;
            }
        }

        // Load saved links when page loads
        document.addEventListener('DOMContentLoaded', loadLinksFromStorage);
    </script>
</body>
</html>